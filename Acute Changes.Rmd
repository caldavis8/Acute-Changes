---
title: "Senior Project"
author: "Calvin Davis"
date: "10/24/2021"
output: word_document
---
```{r}
install.packages("tidyverse")
install.packages("lme4")
install.packages("ggpubr")

```

```{r}
library(ggplot2)
library(tidyr)
library(ggpubr)
library(dplyr)
library(lme4)

setwd("~/Senior Project")
```


```{r}
```


```{r}
calibration_data <- read.csv("Thermocouple calibration data.csv", header = TRUE)
thermocouple_05_10 <- read.csv("05-10-2021 Thermocouple data.csv", header = TRUE)
collection_data <- read.csv("Collection Data.csv", header = TRUE)
aquaflux_data <- read.csv("AquaFluxData.csv", header = TRUE)

```

##Thermocouple calibration
```{r}
ggplot() +
   geom_point(data=calibration_data, 
         aes(x= calibration_data$ï..Place, y = calibration_data$reference_temp1), 
         color = "black") +
   geom_point(data=calibration_data, 
         aes(x=calibration_data$ï..Place, y = calibration_data$Value_E), 
         color = "blue") +
   theme_classic() 
  # scale_x_continuous(limits = c(50,150), breaks=seq(0,150, 10)) 
   
   
```

```{r}
##can be fitted to any of the thermocouples to visualize the calibration curve
ggplot(calibration_data, #graphs thermocouple temp for lead E x reference thermometer temp
      aes(x = Value_C, y = reference_temp2)) +
      geom_point() +
      geom_smooth(method = "lm", se = TRUE) +
      theme_classic() +
      stat_regline_equation() #displays the regression line equation

```
##I have been trying for ages to automate this process instead of manually assembling calibration curves but for the life of me I can't seem to get it

Thermocouple E
```{r}
regression_e <- lm(calibration_data$reference_temp1~calibration_data$Value_E) #calculate regression curve
coef(regression_e) #prints coeffiencts to manually make regression curve
```
## y =  1.011570x - 1.641703


Thermocouple B
```{r}
regression_b <- lm(calibration_data$reference_temp1~calibration_data$Value_B)
coef(regression_b)
```
## y = 1.018007x - 1.671978

Thermocouple H
```{r}
regression_h <- lm(calibration_data$reference_temp1~calibration_data$Value_H)
coef(regression_h)
```
## y =  1.035925x - 1.852796

Thermocouple A
```{r}
regression_a <- lm(calibration_data$reference_temp2~calibration_data$Value_A)
coef(regression_a)
```
## y = 1.010286x - 1.618859

Thermocouple D
```{r}
regression_d <- lm(calibration_data$reference_temp2~calibration_data$Value_D)
coef(regression_d)
```
## y = 1.008465x - 1.621470

Thermocouple F
```{r}
regression_f <- lm(calibration_data$reference_temp2~calibration_data$Value_F)
coef(regression_f)
```
## y = 1.009847x - 1.700887

Thermocouple C
```{r}
regression_c <- lm(calibration_data$reference_temp2~calibration_data$Value_C)
coef(regression_c)
```
## y = 1.005188x - 1.550718     we decided not to use this thermocouple


```{r}
#data frame with of calibration curves
   yint <- c(1.641703, 1.671978, 1.852796, 1.618859, 1.621470, 1.700887, 1.550718)
   slope <- c(1.011570, 1.018007, 1.035925, 1.010286, 1.008465, 1.009847, 1.005188)
   couple <- c("E", "B", "H", "A", "D", "F", "C")

calibration_curves <- data.frame(yint, slope, couple)
split_calibration_curves <- split.data.frame(calibration_curves, f=calibration_curves$couple)

```


```{r}
   #applies calibration equation for E thermocouples
(calibration_curves$slope[1] * $___________$ - calibration_curves$yint[1]
 
    #applies calibration equation for B thermocouples
(calibration_curves$slope[2] * $___________$ - calibration_curves$yint[2]

   #applies calibration equation for H thermocouples
(calibration_curves$slope[3] * $___________$ - calibration_curves$yint[3]
   
   #applies calibration equation for A thermocouples
(calibration_curves$slope[4] * $___________$ - calibration_curves$yint[4]
   
   #applies calibration equation for D thermocouples
(calibration_curves$slope[5] * $___________$ - calibration_curves$yint[5]
   
   #applies calibration equation for F thermocouples
(calibration_curves$slope[6] * $___________$ - calibration_curves$yint[6]
   
   #applies calibration equation for C thermocouples
(calibration_curves$slope[7] * $___________$ - calibration_curves$yint[7]

```



##CEWL Data


##Raw Plot of all data
```{r}
ggplot(aquaflux_data) +
       aes(aquaflux_data$Time_sec, aquaflux_data$Flux_g.m2h, color = aquaflux_data$Treatment) +
       geom_point(size = 0.01) +
       theme_classic() +
       scale_color_manual(values = c("Control" = "forestgreen",
                                     "Cooling" = "steelblue3",  
                                     "Heating"="orange")) +
       labs(x= "Time (sec)" , y= "Flux (g/m^2hr)", color ="Treatment", se = FALSE) +
       scale_y_continuous(trans = "log10") + #transforms to log scale
       scale_x_continuous(limits = c(120,950), breaks=seq(0,950, 50)) 


       #geom_smooth( 
           # aes(aquaflux$Time_sec, aquaflux$Flux_g.m2h, color = aquaflux$Treatment, method = "lm")) 
      # scale_x_continuous(limits = c(0,16), breaks=seq(0,20, 2)) +
       #scale_y_continuous(limits = c(0,7), breaks=seq(0,7, 1))
      #alpha = number controls transparency
```

```{r}
lizard_ID <- as.factor(aquaflux_data$ï..ID)
```


```{r}
##Want a graph where all lines start at same y-intercept, maybe with risduals from a line at log = o



```


##Average CEWL
```{r}
subset_cewl <- aquaflux_data[ which( aquaflux_data$Flux_g.m2h >0 & aquaflux_data$Time_sec >120),]
#eliminate first 2 minutes of data as ambient air is eliminated
sub_id <- as.factor(subset_cewl$ï..ID)

```

```{r}
#finding the average CEWL for each treatment
average_cewl <- data.frame(
                   tapply(subset_cewl$Flux_g.m2h, subset_cewl$ï..ID, mean), #average CEWL/ lizard
                   collection_data$treatment # assigning lizards treatment
   )

colnames(average_cewl) <- c('avg_cewl', 'Treatment')
average_cewl <- tibble::rownames_to_column(average_cewl, "Lizard_ID")
```

```{r}
##average CEWL for each lizard
ggplot() +
   aes(average_cewl$Lizard_ID, average_cewl$avg_cewl, fill = average_cewl$Treatment) +
   geom_col() +
   theme_classic() +
   scale_fill_manual(values = c("Control" = "forestgreen",
                                 "Cooling" = "steelblue3",  
                                 "Heating"="orange")) +
   labs(x= "Lizrd ID" , 
        y= "CEWL (g/m^2hr)", 
        fill ="Treatment") 
```

```{r}
##boxplots to show average CEWL by treatment group after removing first 2 minutes of data to account for intake of ambient air
 ggplot() +
   aes(x = average_cewl$Treatment, 
       y = average_cewl$avg_cewl, 
       fill = average_cewl$Treatment) +
   geom_boxplot() +
   theme_classic() +
   scale_fill_manual(values = c("Control" = "forestgreen",
                                "Cooling" = "steelblue3",  
                                "Heating"="orange"))  +
   scale_y_continuous(limits = c(0,40), breaks=seq(0,40, 5)) +
   labs(x= "Treatment" , y= "Average CEWL (g H2O/m^2hr)", fill ="Treatment") 
```

```{r}
avg_cewl_aov <- aov(average_cewl$avg_cewl~average_cewl$Treatment)

summary(avg_cewl_aov)

TukeyHSD(avg_cewl_aov)
```




##Average Change in CEWL
##Change in CEWL = end pt CEWL - begining pt CEWL
##Avg Change in CEWL = Sum[change in CEWL for 1 treatment] / number of lizards in that treatment
```{r}
initial_pt <- subset(aquaflux_data, Time_sec>119.5 & Time_sec<120.5)
final_pt <- subset(aquaflux_data, Time_sec>=900)


initial_final_cewl <- data.frame(initial_pt$ï..ID,
                                 initial_pt$Flux_g.m2h, 
                                 final_pt$Flux_g.m2h, 
                                 initial_pt$Treatment,
                                 final_pt$Flux_g.m2h - initial_pt$Flux_g.m2h, #Abolsute change
                                 ((final_pt$Flux_g.m2h -     #relative change
                                    initial_pt$Flux_g.m2h)/initial_pt$Flux_g.m2h)*100) 
colnames(initial_final_cewl) <- c('Lizard ID', 
                                  'Initial CEWL', 
                                  'Final CEWL', 
                                  'Treatment', 
                                  'Absolute Change in CEWL', #Final - initial
                                  'Relative Change in CEWL') #Final - initial / initial * 100
```






```{r}
##change in CEWL (final - initial CEWL) by treatment group, based on first and last data points after removing first 2 minutes of data
ggplot() +
   aes(x = initial_final_cewl$Treatment, 
       y = initial_final_cewl$`Absolute Change in CEWL`, 
       fill = initial_final_cewl$Treatment) +
   geom_boxplot() +
   theme_classic() +
   scale_fill_manual(values = c("Control" = "forestgreen",
                                "Cooling" = "steelblue3",  
                                "Heating"="orange"))  +
   labs(x= "Treatment" , y= "Absolute Change in CEWL (g H2O/m^2hr)", fill ="Treatment") 
```

```{r}
change_cewl_aov <- aov(initial_final_cewl$`Absolute Change in CEWL`~initial_final_cewl$Treatment)

summary(change_cewl_aov)

TukeyHSD(change_cewl_aov)
```

```{r}
##Relative change in CEWL (final - initial CEWL)/initial * 100 by treatment group, based on first and last data points after removing first 2 minutes of data
ggplot() +
   aes(x = initial_final_cewl$Treatment, 
       y = initial_final_cewl$`Relative Change in CEWL`, 
       fill = initial_final_cewl$Treatment) +
   geom_boxplot() +
   theme_classic() +
   scale_fill_manual(values = c("Control" = "forestgreen",
                                "Cooling" = "steelblue3",  
                                "Heating"="orange"))  +
   labs(x= "Treatment" , y= "Relative Change in CEWL (%)", fill ="Treatment") 
```

```{r}
change_cewl_aov <- aov(initial_final_cewl$`Relative Change in CEWL`~initial_final_cewl$Treatment)

summary(change_cewl_aov)

TukeyHSD(change_cewl_aov)
```



##Change in CEWL x Mass
```{r}
View(collection_data)
```

```{r}
##Distribution of masseses for each treatment
ggplot() +
   aes( 
       x = collection_data$mass_g,
       fill = collection_data$treatment) + 
   geom_histogram(position = "dodge", 
                  binwidth = 1, 
                  breaks = seq(7, 20, by = 1), 
                  color = "black") +
   theme_classic() +
   scale_fill_manual(values = c("Control" = "forestgreen",
                                "Cooling" = "steelblue3",  
                                "Heating"="orange")) + 
   labs(x= "Mass (g)" , y= "Count", fill ="Treatment") +
   scale_y_continuous(limits = c(0,4), breaks=seq(0,4, 1)) +
   scale_x_continuous(breaks = seq(0, 20, by = 1))
```

```{r}
##Change in CEWL with Mass
ggplot() +
   aes(x = collection_data$mass_g,
       y = initial_final_cewl$`Change in CEWL`,
       color = collection_data$treatment) + 
   geom_point() +
   geom_smooth(method = "lm", se=TRUE) +
   theme_classic() +
   scale_fill_manual(values = c("Control" = "forestgreen",
                                "Cooling" = "steelblue3",  
                                "Heating"="orange")) + 
   labs(x= "Mass (g)" , y= "Change in CEWL", color ="Treatment") 
   #scale_y_continuous(limits = c(0,4), breaks=seq(0,4, 1)) +
   #scale_x_continuous(breaks = seq(0, 20, by = 1))
```


```{r}
##Distribution of SVL's for each treatment
ggplot() +
   aes(x = collection_data$treatment, 
       y = collection_data$SVL_mm,
       fill = collection_data$treatment) + 
   geom_boxplot() +
   theme_classic() +
   scale_fill_manual(values = c("Control" = "forestgreen",
                                "Cooling" = "steelblue3",  
                                "Heating"="orange"))  +
   labs(x= "Treatment" , y= "SVL(mm)", fill ="Treatment") +
    scale_y_continuous(limits = c(0,80), breaks=seq(0,80, 5))
```

```{r}
##Change in CEWL with SVL
ggplot() +
   aes(x = collection_data$SVL_mm,
       y = initial_final_cewl$`Change in CEWL`,
       color = collection_data$treatment) + 
   geom_point() +
   geom_smooth(method = "lm", se=TRUE) +
   theme_classic() +
   scale_color_manual(values = c("Control" = "forestgreen",
                                "Cooling" = "steelblue3",  
                                "Heating"="orange")) + 
   labs(x= "SVL (mm)" , y= "Change in CEWL", color ="Treatment") 
   #scale_y_continuous(limits = c(0,4), breaks=seq(0,4, 1)) +
   #scale_x_continuous(breaks = seq(0, 20, by = 1))
```



##Mixed Linear Model
##random effect: lizard ID
##individual variation: temperature, SVL, mass, body condition, capture climate
##Should I be using change in temperature??

```{r}
data.frame(thermocouple_05_10$Value_C_408, lizzy)
```

```{r}
lizzy<- aquaflux_data$Flux_g.m2h[aquaflux_data$ï..ID=='408']
```


```{r}
x = aquaflux_data$Flux_g.m2h #solving dilemma of different number of rows
y = thermocouple_05_10$Value_C_408

max.len = max(length(x), length(y))
   x = c(x, rep(NA, max.len - length(x)))
   y = c(y, rep(NA, max.len - length(y)))
   
```

```{r}
mixed.lmer <- lmer(initial_final_cewl$`Change in CEWL` ~ initial_final_cewl$Treatment)


summary(mixed.lmer)
```

##a two-sided linear formula object describing both the fixed-effects and random-effects part of the model, with the response on the left of a ~ operator and the terms, separated by + operators, on the right. Random-effects terms are distinguished by vertical bars (|) separating expressions for design matrices from grouping factors. Two vertical bars (||) can be used to specify multiple uncorrelated random effects for the same grouping variabl


```{r}
View(initial_final_cewl)
```

```{r}
lmer()
```

```{r}
View(final_pt)
```


```{r}
initial_pt <- subset(aquaflux_data, Time_sec>119.5 & Time_sec<120.5)
final_pt <- subset(aquaflux_data, Time_sec>=900)

mml_data <- data.frame(initial_pt$ï..ID,
                       collection_data$mass_g, 
                       collection_data$SVL_mm,
                       initial_pt$Treatment,
                       (final_pt$Flux_g.m2h - initial_pt$Flux_g.m2h), #Abolsute change
                       (((final_pt$Flux_g.m2h -     #relative change
                                 initial_pt$Flux_g.m2h)/initial_pt$Flux_g.m2h)*100 ), 
                       final_pt$Temp - initial_pt$Temp)
colnames(mml_data) <- c('Lizard ID', 
                        'Mass (g)',
                        'SVL (mm)',
                        'Treatment', 
                        'Absolute Change in CEWL', #Final - initial
                        'Relative Change in CEWL', #Final - initial / initial * 100
                        'Absolute Change in Temperature')
```



```{r}
View(mml_data)
```

