---
title: "Senior Project"
author: "Calvin Davis"
date: "10/24/2021"
output: word_document
---
```{r}
install.packages("tidyverse")
install.packages("lme4")
install.packages("ggpubr")

```

```{r}
library(ggplot2)
library(tidyr)
library(ggpubr)
library(dplyr)

setwd("~/Senior Project")
```


```{r}
```


```{r}
calibration_data <- read.csv("Thermocouple calibration data.csv", header = TRUE)
thermocouple_05_10 <- read.csv("05-10-2021 Thermocouple data.csv", header = TRUE)
collection_data <- read.csv("Collection Data.csv", header = TRUE)
aquaflux_data <- read.csv("AquaFluxData.csv", header = TRUE)

```

##Thermocouple calibration
```{r}
ggplot() +
   geom_point(data=calibration_data, 
         aes(x= calibration_data$ï..Place, y = calibration_data$reference_temp1), 
         color = "black") +
   geom_point(data=calibration_data, 
         aes(x=calibration_data$ï..Place, y = calibration_data$Value_E), 
         color = "blue") +
   theme_classic() 
  # scale_x_continuous(limits = c(50,150), breaks=seq(0,150, 10)) 
   
   
```

```{r}
##can be fitted to any of the thermocouples to visualize the calibration curve
ggplot(calibration_data, #graphs thermocouple temp for lead E x reference thermometer temp
      aes(x = Value_C, y = reference_temp2)) +
      geom_point() +
      geom_smooth(method = "lm", se = TRUE) +
      theme_classic() +
      stat_regline_equation() #displays the regression line equation

```
##I have been trying for ages to automate this process instead of manually assembling calibration curves but for the life of me I can't seem to get it

Thermocouple E
```{r}
regression_e <- lm(calibration_data$reference_temp1~calibration_data$Value_E) #calculate regression curve
coef(regression_e) #prints coeffiencts to manually make regression curve
```
## y =  1.011570x - 1.641703


Thermocouple B
```{r}
regression_b <- lm(calibration_data$reference_temp1~calibration_data$Value_B)
coef(regression_b)
```
## y = 1.018007x - 1.671978

Thermocouple H
```{r}
regression_h <- lm(calibration_data$reference_temp1~calibration_data$Value_H)
coef(regression_h)
```
## y =  1.035925x - 1.852796

Thermocouple A
```{r}
regression_a <- lm(calibration_data$reference_temp2~calibration_data$Value_A)
coef(regression_a)
```
## y = 1.010286x - 1.618859

Thermocouple D
```{r}
regression_d <- lm(calibration_data$reference_temp2~calibration_data$Value_D)
coef(regression_d)
```
## y = 1.008465x - 1.621470

Thermocouple F
```{r}
regression_f <- lm(calibration_data$reference_temp2~calibration_data$Value_F)
coef(regression_f)
```
## y = 1.009847x - 1.700887

Thermocouple C
```{r}
regression_c <- lm(calibration_data$reference_temp2~calibration_data$Value_C)
coef(regression_c)
```
## y = 1.005188x - 1.550718     we decided not to use this thermocouple


```{r}
#data frame with of calibration curves
   yint <- c(1.641703, 1.671978, 1.852796, 1.618859, 1.621470, 1.700887, 1.550718)
   slope <- c(1.011570, 1.018007, 1.035925, 1.010286, 1.008465, 1.009847, 1.005188)
   couple <- c("E", "B", "H", "A", "D", "F", "C")

calibration_curves <- data.frame(yint, slope, couple)
split_calibration_curves <- split.data.frame(calibration_curves, f=calibration_curves$couple)

```


```{r}
   #applies calibration equation for E thermocouples
(calibration_curves$slope[1] * $___________$ - calibration_curves$yint[1]
 
    #applies calibration equation for B thermocouples
(calibration_curves$slope[2] * $___________$ - calibration_curves$yint[2]

   #applies calibration equation for H thermocouples
(calibration_curves$slope[3] * $___________$ - calibration_curves$yint[3]
   
   #applies calibration equation for A thermocouples
(calibration_curves$slope[4] * $___________$ - calibration_curves$yint[4]
   
   #applies calibration equation for D thermocouples
(calibration_curves$slope[5] * $___________$ - calibration_curves$yint[5]
   
   #applies calibration equation for F thermocouples
(calibration_curves$slope[6] * $___________$ - calibration_curves$yint[6]
   
   #applies calibration equation for C thermocouples
(calibration_curves$slope[7] * $___________$ - calibration_curves$yint[7]

```



##CEWL Data


##Raw Plot of all data
```{r}
ggplot(aquaflux_data) +
       aes(aquaflux_data$Time_sec, aquaflux_data$Flux_g.m2h, color = aquaflux_data$Treatment) +
       geom_point(size = 0.01) +
       theme_classic() +
       scale_color_manual(values = c(
          "Control" = "snow4","Cooling" = "steelblue3",  "Heating"="orange")) +
       labs(x= "Time (sec)" , y= "Flux (g/m^2hr)", color ="Treatment", se = FALSE) +
       scale_x_continuous(limits = c(120,950), breaks=seq(0,950, 50)) 


       #geom_smooth( 
           # aes(aquaflux$Time_sec, aquaflux$Flux_g.m2h, color = aquaflux$Treatment, method = "lm")) 
      # scale_x_continuous(limits = c(0,16), breaks=seq(0,20, 2)) +
       #scale_y_continuous(limits = c(0,7), breaks=seq(0,7, 1))
      #alpha = number controls transparency
```

```{r}
lizard_ID <- as.factor(aquaflux_data$ï..ID)
```


##Average CEWL
```{r}
subset_cewl <- aquaflux_data[ which( aquaflux_data$Flux_g.m2h >0 & aquaflux_data$Time_sec >120),]
#eliminate first 2 minutes of data as ambient air is eliminated
sub_id <- as.factor(subset_cewl$ï..ID)

```

```{r}
#finding the average CEWL for each treatment
average_cewl <- data.frame(
                   tapply(subset_cewl$Flux_g.m2h, subset_cewl$ï..ID, mean), #average CEWL/ lizard
                   collection_data$treatment # assigning lizards treatment
   )

colnames(average_cewl) <- c('avg_cewl', 'Treatment')
average_cewl <- tibble::rownames_to_column(average_cewl, "Lizard_ID")
```

```{r}
##average CEWL for each lizard
ggplot() +
   aes(average_cewl$Lizard_ID, average_cewl$avg_cewl, fill = average_cewl$Treatment) +
   geom_col() +
   theme_classic() +
   scale_fill_manual(values = c("Control" = "snow4",
                                 "Cooling" = "steelblue3",  
                                 "Heating"="orange")) +
   labs(x= "Lizrd ID" , 
        y= "CEWL (g/m^2hr)", 
        fill ="Treatment") 
```

```{r}
##boxplots to show average CEWL by treatment group after removing first 2 minutes of data to account for intake of ambient air
 ggplot() +
   aes(x = average_cewl$Treatment, 
       y = average_cewl$avg_cewl, 
       fill = average_cewl$Treatment) +
   geom_boxplot() +
   theme_classic() +
   scale_fill_manual(values = c("Control" = "snow4",
                                "Cooling" = "steelblue3",  
                                "Heating"="orange"))  +
   scale_y_continuous(limits = c(0,40), breaks=seq(0,40, 5)) +
   labs(x= "Treatment" , y= "Average CEWL (g H2O/m^2hr)", fill ="Treatment") 
```

```{r}
avg_cewl_aov <- aov(average_cewl$avg_cewl~average_cewl$Treatment)

summary(avg_cewl_aov)

TukeyHSD(avg_cewl_aov)
```




##Average Change in CEWL
##Change in CEWL = end pt CEWL - begining pt CEWL
##Avg Change in CEWL = Sum[change in CEWL for 1 treatment] / number of lizards in that treatment

```{r}
initial_pt <- subset(aquaflux_data, Time_sec>119.5 & Time_sec<120.5)
final_pt <- subset(aquaflux_data, Time_sec>=900)


initial_final_cewl <- data.frame(initial_pt$ï..ID,
                                 initial_pt$Flux_g.m2h, 
                                 final_pt$Flux_g.m2h, 
                                 initial_pt$Treatment,
                                 final_pt$Flux_g.m2h - initial_pt$Flux_g.m2h)
colnames(initial_final_cewl) <- c('Lizard ID', 
                                  'Initial CEWL', 
                                  'Final CEWL', 
                                  'Treatment', 
                                  'Change in CEWL')
```


```{r}
##change in CEWL (final - initial CEWL) by treatment group
ggplot() +
   aes(x = initial_final_cewl$Treatment, 
       y = initial_final_cewl$`Change in CEWL`, 
       fill = initial_final_cewl$Treatment) +
   geom_boxplot() +
   theme_classic() +
   scale_fill_manual(values = c("Control" = "snow4",
                                "Cooling" = "steelblue3",  
                                "Heating"="orange"))  +
   #scale_y_continuous(limits = c(0,40), breaks=seq(0,40, 5)) +
   labs(x= "Treatment" , y= "Average Change in CEWL (g H2O/m^2hr)", fill ="Treatment") 
```

```{r}
change_cewl_aov <- aov(initial_final_cewl$`Change in CEWL`~initial_final_cewl$Treatment)

summary(change_cewl_aov)

TukeyHSD(change_cewl_aov)
```


